<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <header
    th:with="isOverlayPage=${isOverlayPage != null ? isOverlayPage : true}"
    x-data="{ isOpen: false, searchOpen: false, userMenuOpen: false, isVisible: true, lastScrollY: 0, isHovered: false, isScrolledPastHero: false }"
    x-init="
      window.addEventListener('scroll', () => {
        const currentScrollY = window.scrollY;
        isVisible = currentScrollY === 0 || currentScrollY < lastScrollY;
        lastScrollY = currentScrollY;
        isScrolledPastHero = currentScrollY > 600;
      });
    "
    class="left-0 right-0 z-40 transition-all duration-300"
    th:classappend="${isOverlayPage ? 'fixed top-0' : 'relative'}"
    :class="{
      'translate-y-0': isVisible,
      '-translate-y-full': !isVisible,
      'bg-white/70 dark:bg-black/70 shadow-lg': isScrolledPastHero || isHovered,
      'bg-white/70 dark:bg-black/70': !isScrolledPastHero && !isHovered
    }"
    @mouseenter="isHovered = true"
    @mouseleave="isHovered = false"
  >
    <nav class="mx-auto">
      <div class="flex h-14 items-center justify-between">
        <div class="flex pl-4">
          <div class="flex flex-shrink-0">
            <a th:href="@{/}" class="flex transform items-center transition-transform duration-200 hover:scale-105">
              <img
                th:src="${site.logo}"
                alt="网站Logo"
                class="h-8 w-8 rounded-full object-cover shadow-lg ring-2 ring-white/50 dark:shadow-gray-700 dark:ring-gray-800/50"
              />
              <span class="ml-3 text-xl tracking-tight text-gray-800 dark:text-white" th:text="${site.title}"></span>
            </a>
          </div>
          <!-- Desktop Menu -->
          <div class="ml-8 hidden sm:flex sm:space-x-2">
            <a
              th:each="menuItem : ${menuFinder.getPrimary().menuItems}"
              th:href="${menuItem.status.href}"
              th:text="${menuItem.status.displayName}"
              class="relative inline-flex items-center px-3 py-2 text-base text-gray-600 transition-all duration-200 after:absolute after:bottom-0 after:left-1/2 after:right-1/2 after:h-0.5 after:bg-gradient-to-r after:from-transparent after:via-primary after:to-transparent after:transition-all after:duration-300 hover:scale-105 hover:text-gray-800 hover:after:left-0 hover:after:right-0 dark:text-gray-200 dark:hover:text-white"
            ></a>
          </div>
        </div>
        <div class="relative flex items-center space-x-2 pr-4">
          <!-- 搜索按钮 - 只在搜索插件启用时显示 -->
          <div th:if="${pluginFinder.available('PluginSearchWidget')}">
            <button
              @click="SearchWidget.open()"
              class="transform rounded-full p-1 text-gray-600 transition-all duration-300 ease-out hover:scale-110 hover:text-gray-800 dark:text-gray-200 dark:hover:text-white"
            >
              <svg
                class="h-5 w-5"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <circle cx="11" cy="11" r="8" />
                <path d="M18 18L21 21" />
              </svg>
            </button>
          </div>

          <!-- 多主题切换 -->
          <th:block th:replace="~{modules/common/theme-switch}"></th:block>

          <div
            x-data="{ open: false }"
            class="relative cursor-pointer transition-all"
            th:with="currentUser = ${contributorFinder.getContributor(#authentication.name)}"
          >
            <button
              @click="open = !open"
              class="flex items-center space-x-2 transition-transform duration-300 focus:outline-none group-hover:scale-105"
            >
              <img
                class="h-8 w-8 transform rounded-full object-cover shadow-lg ring-2 ring-white/30 transition-all duration-300 hover:shadow-xl group-hover:ring-blue-500/50 dark:ring-gray-700/30 dark:group-hover:ring-blue-400/50"
                th:src="${currentUser.avatar}"
                th:alt="${currentUser.displayName}"
              />
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4 text-gray-500 transition-transform duration-200"
                :class="{'rotate-180': open}"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <path
                  fill-rule="evenodd"
                  d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                  clip-rule="evenodd"
                />
              </svg>
            </button>

            <div
              x-show="open"
              x-cloak
              @click.away="open = false"
              x-transition:enter="transition ease-out duration-200"
              x-transition:enter-start="opacity-0 scale-95"
              x-transition:enter-end="opacity-100 scale-100"
              x-transition:leave="transition ease-in duration-150"
              x-transition:leave-start="opacity-100 scale-100"
              x-transition:leave-end="opacity-0 scale-95"
              class="absolute right-0 z-20 mt-2 w-48 origin-top-right overflow-hidden rounded-xl border border-gray-100/10 bg-white/90 shadow-lg backdrop-blur-lg dark:border-gray-700/30 dark:bg-gray-800/90"
            >
              <div class="divide-y divide-gray-100/10 dark:divide-gray-700/30">
                <div sec:authorize="isAuthenticated()" class="space-y-1 p-2">
                  <a
                    href="/console"
                    target="_blank"
                    class="flex items-center space-x-2 rounded-lg px-3 py-2 text-sm text-gray-700 transition-colors hover:bg-gray-100/50 dark:text-gray-200 dark:hover:bg-gray-700/50"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                      <path
                        d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM14 11a1 1 0 011 1v1h1a1 1 0 110 2h-1v1a1 1 0 11-2 0v-1h-1a1 1 0 110-2h1v-1a1 1 0 011-1z"
                      />
                    </svg>
                    <span>控制台</span>
                  </a>
                  <a
                    href="/logout"
                    class="flex items-center space-x-2 rounded-lg px-3 py-2 text-sm text-gray-700 transition-colors hover:bg-gray-100/50 dark:text-gray-200 dark:hover:bg-gray-700/50"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                      <path
                        fill-rule="evenodd"
                        d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z"
                        clip-rule="evenodd"
                      />
                    </svg>
                    <span>退出登录</span>
                  </a>
                </div>
                <div sec:authorize="isAnonymous()" class="p-2">
                  <a
                    href="/console/login"
                    class="flex items-center space-x-2 rounded-lg px-3 py-2 text-sm text-gray-700 transition-colors hover:bg-gray-100/50 dark:text-gray-200 dark:hover:bg-gray-700/50"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                      <path
                        fill-rule="evenodd"
                        d="M3 3a1 1 0 011 1v12a1 1 0 11-2 0V4a1 1 0 011-1zm7.707 3.293a1 1 0 010 1.414L9.414 9H17a1 1 0 110 2H9.414l1.293 1.293a1 1 0 01-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0z"
                        clip-rule="evenodd"
                      />
                    </svg>
                    <span>登录</span>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </nav>
  </header>
</html>
